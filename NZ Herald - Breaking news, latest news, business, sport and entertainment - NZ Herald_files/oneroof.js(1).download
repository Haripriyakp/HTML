(function($){"use strict";function safeAdd(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bitRotateLeft(num,cnt){return num<<cnt|num>>>32-cnt}function md5cmn(q,a,b,x,s,t){return safeAdd(bitRotateLeft(safeAdd(safeAdd(a,q),safeAdd(x,t)),s),b)}function md5ff(a,b,c,d,x,s,t){return md5cmn(b&c|~b&d,a,b,x,s,t)}function md5gg(a,b,c,d,x,s,t){return md5cmn(b&d|c&~d,a,b,x,s,t)}function md5hh(a,b,c,d,x,s,t){return md5cmn(b^c^d,a,b,x,s,t)}function md5ii(a,b,c,d,x,s,t){return md5cmn(c^(b|~d),a,b,x,s,t)}function binlMD5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var i;var olda;var oldb;var oldc;var oldd;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=md5ff(a,b,c,d,x[i],7,-680876936);d=md5ff(d,a,b,c,x[i+1],12,-389564586);c=md5ff(c,d,a,b,x[i+2],17,606105819);b=md5ff(b,c,d,a,x[i+3],22,-1044525330);a=md5ff(a,b,c,d,x[i+4],7,-176418897);d=md5ff(d,a,b,c,x[i+5],12,1200080426);c=md5ff(c,d,a,b,x[i+6],17,-1473231341);b=md5ff(b,c,d,a,x[i+7],22,-45705983);a=md5ff(a,b,c,d,x[i+8],7,1770035416);d=md5ff(d,a,b,c,x[i+9],12,-1958414417);c=md5ff(c,d,a,b,x[i+10],17,-42063);b=md5ff(b,c,d,a,x[i+11],22,-1990404162);a=md5ff(a,b,c,d,x[i+12],7,1804603682);d=md5ff(d,a,b,c,x[i+13],12,-40341101);c=md5ff(c,d,a,b,x[i+14],17,-1502002290);b=md5ff(b,c,d,a,x[i+15],22,1236535329);a=md5gg(a,b,c,d,x[i+1],5,-165796510);d=md5gg(d,a,b,c,x[i+6],9,-1069501632);c=md5gg(c,d,a,b,x[i+11],14,643717713);b=md5gg(b,c,d,a,x[i],20,-373897302);a=md5gg(a,b,c,d,x[i+5],5,-701558691);d=md5gg(d,a,b,c,x[i+10],9,38016083);c=md5gg(c,d,a,b,x[i+15],14,-660478335);b=md5gg(b,c,d,a,x[i+4],20,-405537848);a=md5gg(a,b,c,d,x[i+9],5,568446438);d=md5gg(d,a,b,c,x[i+14],9,-1019803690);c=md5gg(c,d,a,b,x[i+3],14,-187363961);b=md5gg(b,c,d,a,x[i+8],20,1163531501);a=md5gg(a,b,c,d,x[i+13],5,-1444681467);d=md5gg(d,a,b,c,x[i+2],9,-51403784);c=md5gg(c,d,a,b,x[i+7],14,1735328473);b=md5gg(b,c,d,a,x[i+12],20,-1926607734);a=md5hh(a,b,c,d,x[i+5],4,-378558);d=md5hh(d,a,b,c,x[i+8],11,-2022574463);c=md5hh(c,d,a,b,x[i+11],16,1839030562);b=md5hh(b,c,d,a,x[i+14],23,-35309556);a=md5hh(a,b,c,d,x[i+1],4,-1530992060);d=md5hh(d,a,b,c,x[i+4],11,1272893353);c=md5hh(c,d,a,b,x[i+7],16,-155497632);b=md5hh(b,c,d,a,x[i+10],23,-1094730640);a=md5hh(a,b,c,d,x[i+13],4,681279174);d=md5hh(d,a,b,c,x[i],11,-358537222);c=md5hh(c,d,a,b,x[i+3],16,-722521979);b=md5hh(b,c,d,a,x[i+6],23,76029189);a=md5hh(a,b,c,d,x[i+9],4,-640364487);d=md5hh(d,a,b,c,x[i+12],11,-421815835);c=md5hh(c,d,a,b,x[i+15],16,530742520);b=md5hh(b,c,d,a,x[i+2],23,-995338651);a=md5ii(a,b,c,d,x[i],6,-198630844);d=md5ii(d,a,b,c,x[i+7],10,1126891415);c=md5ii(c,d,a,b,x[i+14],15,-1416354905);b=md5ii(b,c,d,a,x[i+5],21,-57434055);a=md5ii(a,b,c,d,x[i+12],6,1700485571);d=md5ii(d,a,b,c,x[i+3],10,-1894986606);c=md5ii(c,d,a,b,x[i+10],15,-1051523);b=md5ii(b,c,d,a,x[i+1],21,-2054922799);a=md5ii(a,b,c,d,x[i+8],6,1873313359);d=md5ii(d,a,b,c,x[i+15],10,-30611744);c=md5ii(c,d,a,b,x[i+6],15,-1560198380);b=md5ii(b,c,d,a,x[i+13],21,1309151649);a=md5ii(a,b,c,d,x[i+4],6,-145523070);d=md5ii(d,a,b,c,x[i+11],10,-1120210379);c=md5ii(c,d,a,b,x[i+2],15,718787259);b=md5ii(b,c,d,a,x[i+9],21,-343485551);a=safeAdd(a,olda);b=safeAdd(b,oldb);c=safeAdd(c,oldc);d=safeAdd(d,oldd)}return[a,b,c,d]}function binl2rstr(input){var i;var output="";var length32=input.length*32;for(i=0;i<length32;i+=8){output+=String.fromCharCode(input[i>>5]>>>i%32&255)}return output}function rstr2binl(input){var i;var output=[];output[(input.length>>2)-1]=undefined;for(i=0;i<output.length;i+=1){output[i]=0}var length8=input.length*8;for(i=0;i<length8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32}return output}function rstrMD5(s){return binl2rstr(binlMD5(rstr2binl(s),s.length*8))}function rstrHMACMD5(key,data){var i;var bkey=rstr2binl(key);var ipad=[];var opad=[];var hash;ipad[15]=opad[15]=undefined;if(bkey.length>16){bkey=binlMD5(bkey,key.length*8)}for(i=0;i<16;i+=1){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}hash=binlMD5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binlMD5(opad.concat(hash),512+128))}function rstr2hex(input){var hexTab="0123456789abcdef";var output="";var x;var i;for(i=0;i<input.length;i+=1){x=input.charCodeAt(i);output+=hexTab.charAt(x>>>4&15)+hexTab.charAt(x&15)}return output}function str2rstrUTF8(input){return unescape(encodeURIComponent(input))}function rawMD5(s){return rstrMD5(str2rstrUTF8(s))}function hexMD5(s){return rstr2hex(rawMD5(s))}function rawHMACMD5(k,d){return rstrHMACMD5(str2rstrUTF8(k),str2rstrUTF8(d))}function hexHMACMD5(k,d){return rstr2hex(rawHMACMD5(k,d))}function md5(string,key,raw){if(!key){if(!raw){return hexMD5(string)}return rawMD5(string)}if(!raw){return hexHMACMD5(key,string)}return rawHMACMD5(key,string)}if(typeof define==="function"&&define.amd){define(function(){return md5})}else if(typeof module==="object"&&module.exports){module.exports=md5}else{$.md5=md5}})(this);(function(dom,$){"use strict";var _placeholder=["Search for a home to buy - by suburb, city, or property ID","Find a home to rent - by suburb, city, or property ID","What's your home worth? Search by address"];var _domBuffer=['<div class="oneroof">','<div class="cont">','<h3 class="title">','<span class="s">OneRoof Property</span>','<a href="https://www.oneroof.co.nz/?ref=NZH_search" target="_blank">','<img src="https://www.oneroof.co.nz/static/img/logo.png" alt="Oneroof" class="logo" />',"</a>","</h3>",'<div class="search-bg">','<ul class="tabs">','<li class="item active" data-type="buy" data-pi="0">Buy</li>','<li class="item" data-type="rent" data-pi="1">Rent</li>','<li class="item" data-type="estimate" data-pi="2">Valuation</li>',"</ul>",'<div class="search-box">','<div class="text-box">','<ul class="suburb-box hide"></ul>','<input type="text" class="search-text" placeholder="',_placeholder[0],'" />','<div class="text-copy"></div>',"</div>",'<input type="button" value="Search" class="search-btn" />','<div class="popup-box hide"></div>',"</div>","</div>","</div>","</div>"];var _baseUrl="https://api.oneroof.co.nz/v1.7/enum/homepage";var _domain="https://www.oneroof.co.nz";var _typeId=[1,5,-100];var _baseHeader={Authorization:"Public "+window.btoa("B41n73ivbk-w0W8OyEkm1-whmnE9w66e:ps4z1a4c5J-NpDc6ujX67-YNyBgX8D7o"),"Content-Type":"application/json",Client:"web"};var _css=".oneroof{background-color:#fff}.oneroof ul,.oneroof li{list-style:none;margin:0;padding:0}.oneroof .hide{display:none}.oneroof .cont{max-width:965px;margin:0 auto;padding:30px 10px 15px 10px}.oneroof .title{font-size:30px;min-height:30px;text-align:center;position:relative;color:#242830;white-space:nowrap;margin:0;font-family:'Stag Light','Georgia',serif}.oneroof .title .logo{position:absolute;right:0;top:0}.oneroof .search-bg{background-color:#f2f5f7;padding:15px 10px;margin-top:15px}.oneroof .tabs{list-style:none;width:100%;overflow:hidden;zoom:1}.oneroof .tabs .item{height:40px;line-height:38px;border:1px solid #fff;border-left-width:0;float:left;width:33%;box-sizing:border-box;cursor:pointer;color:#fff;text-align:center;font-size:16px;background-color:#242830}.oneroof .tabs .item:first-child{border-left-width:1px;width:34%;border-radius:3px 0 0 3px}.oneroof .tabs .item:last-child{border-radius:0 3px 3px 0}.oneroof .tabs .item.active{background-color:#ff8500}.oneroof .search-box{background-color:#fff;border-radius:2px;padding:5px;position:relative;border:1px solid #e4e4e4;margin-top:10px;padding-right:80px;cursor:text}.oneroof .search-box::after{content:'';display:block;clear:both}.oneroof .search-box.popup{border-radius:2px 2px 2px 0}.oneroof .search-box.estimate{padding-right:5px}.oneroof .search-box.estimate .search-btn{display:none}.oneroof .search-box .text-box{position:relative}.oneroof .text-box .popup-box{top:100%;left:-5px;margin-top:5px;border-radius:0 0 2px 2px}.oneroof .search-box .text-copy,.oneroof .search-box .search-text{width:100%;border:0;font-size:16px;padding:0 5px;box-sizing:border-box;outline:0;height:35px;float:left;min-width:15px}.oneroof .search-box .text-copy{position:absolute;right:-100px;top:-100px;visibility:hidden;z-index:-1;width:initial}.oneroof .search-box .search-btn{border-radius:3px;background-color:#ff8500;color:#fff;border:0;cursor:pointer;padding:0;position:absolute;right:5px;top:5px;width:60px;height:35px;font-size:14px;outline:0}.oneroof .widget{font-size:14px;color:#fff;background-color:#ff8500;border-radius:2px;white-space:nowrap;padding:2px 5px;float:left;margin:5px 0 0 5px}.oneroof .widget .delete{margin-left:5px;font-style:normal;cursor:pointer}.oneroof .popup-box{position:absolute;left:-1px;right:-1px;background-color:#fff;z-index:999;top:100%}.oneroof .group .g-title{height:35px;line-height:35px;padding:0 15px;color:#8a8a8a;background-color:rgba(197,217,191,0.2);font-size:13px;border-left:1px solid #e6e9ed;border-right:1px solid #e6e9ed;white-space:nowrap}.oneroof .icon-suburb,.oneroof .icon-address{width:14px;height:15px;display:inline-block;vertical-align:middle;margin-right:5px;background-repeat:no-repeat;background-position:center center;margin-top:-4px}.oneroof .icon-suburb{background-image:url('https://www.oneroof.co.nz/static/img/position.png')}.oneroof .icon-address{background-image:url('https://www.oneroof.co.nz/static/img/search.png')}.oneroof .group .row{font-size:16px;color:#8a8a8a;padding:0 15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-left:1px solid #e6e9ed;border-right:1px solid #e6e9ed;cursor:pointer}.oneroof .group .row.active{color:#fff;background-color:#ff8500;border-left-color:#ff8500;border-right-color:#ff8500}.oneroof .group .row.active mark{color:#fff}.oneroof .group .img{width:43px;height:28px;display:inline-block;vertical-align:middle;margin-right:5px}.oneroof .group .s{height:38px;line-height:38px;vertical-align:middle}.oneroof .group mark{color:#242831;background-color:transparent;margin:0;padding:0}@media(max-width:750px){.oneroof .title .s{display:none}}";var _isAppend=false;function oneroof(){this.selector=null;this.init=function(selector){if(selector&&$){this.selector=selector;render();addEventListener()}else{console.log("oneroof init error")}};var _instance=this;var appendCss=function(){!_isAppend&&$(dom.head).append(['<style type="text/css">',_css,"</style>"].join(""));_isAppend=true};var render=function(){appendCss();var container=$(_instance.selector);container.html(_domBuffer.join(""))};var addEventListener=function(){var container=$(_instance.selector);container.find(".tabs .item").click(function(){fn.toggleTab(this)});container.find(".search-box").click(function(event){var text=$(this).find(".search-text");text.focus();fn.togglePopup(true);event.stopPropagation()});container.find(".search-text").on("input",function(){var typeId=_typeId[container.find(".tabs .item.active").index()];fn.search(this,typeId);fn.calcInputWidth()}).on("click",function(event){fn.togglePopup(true);event.stopPropagation()}).on("keydown",function(event){if(event.keyCode==38){fn.changePopupItem(-1);return false}else if(event.keyCode==40){fn.changePopupItem(1);return false}else if(event.keyCode==13){fn.enterHandler();fn.calcInputWidth();return false}else if(event.keyCode==8){fn.deleteHandler();fn.calcInputWidth()}});container.find(".popup-box").on("mouseenter click",".row",function(event){if(event.type=="mouseenter"){fn.togglePopupItem(this)}else if(event.type=="click"){fn.enterHandler();fn.calcInputWidth();event.stopPropagation()}});container.find(".suburb-box").on("click",".widget .delete",function(){var row=$(this).parent();var id=row.data("id");fn.deleteSuburb({id:id})});container.find(".search-btn").click(function(event){fn.searchHandle();event.stopPropagation()});$(dom).click(function(){fn.togglePopup(false)})};var _timer=null;var _cacheSuburbs=[];var _cacheListings=[];var _cacheSuburbsSelected=[];var fn={toggleTab:function(item){var tab=$(item);var searchBox=$(_instance.selector).find(".search-box");tab.siblings().removeClass("active");tab.addClass("active");fn.emptyPopup();fn.clearSelectedSuburbs();fn.calcInputWidth()},setPlaceholder:function(){var tab=$(_instance.selector).find(".item.active");var searchText=$(_instance.selector).find(".search-text");if(_cacheSuburbsSelected.length===0){searchText.prop("placeholder",_placeholder[tab.data("pi")])}else{searchText.prop("placeholder","")}searchText.focus()},togglePopup:function(view){var popupBox=$(_instance.selector).find(".popup-box");var searchBox=$(_instance.selector).find(".search-box");var html=popupBox.html();if(view){popupBox.removeClass("hide");html&&searchBox.addClass("popup")}else{popupBox.addClass("hide");searchBox.removeClass("popup")}},togglePopupItem:function(item){$(_instance.selector).find(".popup-box .row").removeClass("active");$(item).addClass("active")},changePopupItem:function(n){var rows=$(_instance.selector).find(".popup-box .row");var len=rows.length;var subindex=-1;rows.each(function(index,row){if($(row).hasClass("active")){subindex=index}});subindex+=n;if(subindex<0){subindex=len-1}else if(subindex>=len){subindex=0}fn.togglePopupItem(rows[subindex])},enterHandler:function(){var data=fn.getCurrentItemData()||fn.getMaxCountData();if(!data){if(_cacheSuburbsSelected.length==0||_cacheSuburbsSelected.length>0&&!fn.getKeywrods()){fn.searchHandle()}return}var url=null;if(fn.isEstimate()){var d=data.data;if(data.type=="property"){url=[_domain,"/estimate/",d.slug].join("")}}else{if(data.type=="suburb"){fn.addSuburb(data.data)}else if(data.type=="property"){url=[_domain,data.data.slug].join("/")}}if(url)fn.winOpen(url);fn.emptyPopup()},searchHandle:function(){if(fn.isEstimate())return;var url=null;var keywords=fn.getKeywrods();if(_cacheSuburbsSelected.length>0){var regions=[];var districts=[];var suburbs=[];for(var i=0,len=_cacheSuburbsSelected.length,item;i<len;i++){item=_cacheSuburbsSelected[i];if(item.level=="region"){regions.push(fn.getSlug([item.pure_label,item.id]))}else if(item.level=="district"){districts.push(fn.getSlug([item.pure_label,item.id]))}else if(item.level=="suburb"){suburbs.push(fn.getSlug([item.pure_label,item.id]))}}var suburbStr=[];if(suburbs.length>0){suburbStr.push("suburb_"+suburbs.join(","))}if(districts.length>0){suburbStr.push("district_"+districts.join(","))}if(regions.length>0){suburbStr.push("region_"+regions.join(","))}var type="houses-for-sale";if(fn.isRent())type="houses-for-rent";url=[_domain,"search",type,suburbStr.join("_")+"_surround_page_1"].join("/")}else if(keywords){var type="houses-for-sale";if(fn.isRent())type="houses-for-rent";url=[_domain,"/search/",type,"/surround_description_",keywords,"_page_1"].join("")}if(url)fn.winOpen(url)},getCurrentItemData:function(){var row=$(_instance.selector).find(".popup-box .row.active");var type=row.data("type");var index=row.index();var data=null;if(row.length==0)return null;if(type=="suburb"){data=_cacheSuburbs[index]}else if(type=="property"){data=_cacheListings[index]}return{type:type,data:data}},getMaxCountData:function(){if(_cacheSuburbs.length>0){var max=_cacheSuburbs[0];for(var i=0,len=_cacheSuburbs.length,item;i<len;i++){item=_cacheSuburbs[i];if(item.house_count>max.house_count){max=item}}return{type:"suburb",data:max}}else if(_cacheListings.length>0){return{type:"property",data:_cacheListings[0]}}return null},deleteHandler:function(){if(_cacheSuburbsSelected.length==0)return;var val=fn.getKeywrods();if(!val){fn.deleteSuburb(_cacheSuburbsSelected[_cacheSuburbsSelected.length-1])}},addSuburb:function(suburb){var subindex=-1;for(var i=0,len=_cacheSuburbsSelected.length,item;i<len;i++){item=_cacheSuburbsSelected[i];if(suburb.id==item.id){subindex=i;break}}if(subindex==-1){_cacheSuburbsSelected.push(suburb);fn.renderSelectedSuburbs()}},deleteSuburb:function(suburb){var subindex=-1;for(var i=0,len=_cacheSuburbsSelected.length,item;i<len;i++){item=_cacheSuburbsSelected[i];if(suburb.id==item.id){subindex=i;break}}if(subindex!=-1){_cacheSuburbsSelected.splice(subindex,1);fn.renderSelectedSuburbs()}},clearSelectedSuburbs:function(){_cacheSuburbsSelected=[];fn.renderSelectedSuburbs()},search:function(input,typeId){var keywords=$(input).val();clearTimeout(_timer);if(keywords){_timer=setTimeout(function(){fn.fetch(keywords,typeId,_instance)},500)}else{fn.emptyPopup()}},fetch:function(keywords,typeId){var params={key:keywords,typeId:typeId};send(params).then(function(data){fn.renderPopup(data,_instance)})},emptyPopup:function(){fn.renderPopup({},_instance);$(_instance.selector).find(".search-text").val("")},renderPopup:function(data){var popupBox=$(_instance.selector).find(".popup-box");var searchBox=$(_instance.selector).find(".search-box");var _locations=data.locations||[];var _suburbs=data.suburbs||[];var _streets=data.streets||[];var listings=data.listings||[];var suburbs=fn.megerArray(_locations,_suburbs);if(fn.isEstimate()){suburbs=[]}var suburbsBuffer=[];if(suburbs.length>0){suburbsBuffer.push('<div class="group"><div class="g-title"><i class="icon-suburb"></i>Location</div><ul class="g-list">');for(var i=0,len=suburbs.length,item;i<len;i++){item=suburbs[i];suburbsBuffer.push(_rs(item))}suburbsBuffer.push("</ul></div>")}var listingBuffer=[];if(listings.length>0){listingBuffer.push('<div class="group"><div class="g-title"><i class="icon-address"></i>Address, Property ID</div><ul class="g-list">');for(var i=0,len=listings.length,item;i<len;i++){item=listings[i];listingBuffer.push(_rp(item))}listingBuffer.push("</ul></div>")}if(suburbsBuffer.length>0||listingBuffer.length>0){searchBox.addClass("popup");popupBox.removeClass("hide").html(suburbsBuffer.join("")+listingBuffer.join(""))}else{searchBox.removeClass("popup");popupBox.addClass("hide").empty()}_cacheListings=listings;_cacheSuburbs=suburbs;function _rs(suburb){return['<li class="row" data-type="suburb"><span class="s">',suburb.label,suburb.house_count?" ("+suburb.house_count+" properties)":"","</span></li>"].join("")}function _rp(suburb){return['<li class="row" data-type="property">',suburb.cover?'<img src="'+fn.widthImg(suburb.cover,50)+'" class="img" />':"",'<span class="s">',suburb.label,"</span></li>"].join("")}},renderSelectedSuburbs:function(){var suburbsBox=$(_instance.selector).find(".suburb-box");var htmlBuffer=[];for(var i=0,len=_cacheSuburbsSelected.length,item;i<len;i++){item=_cacheSuburbsSelected[i];htmlBuffer.push('<li class="widget" data-id="',item.id,'">',item.pure_label,'<i class="delete">x</i></li>')}if(htmlBuffer.length>0){suburbsBox.removeClass("hide").html(htmlBuffer.join(""))}else{suburbsBox.addClass("hide").empty()}},isBuy:function(){var tab=$(_instance.selector).find(".tabs .item.active");return tab.data("type")=="buy"},isRent:function(){var tab=$(_instance.selector).find(".tabs .item.active");return tab.data("type")=="rent"},isEstimate:function(){var tab=$(_instance.selector).find(".tabs .item.active");return tab.data("type")=="estimate"},megerArray:function(target,from){var res=[];for(var i=0,len=from.length,item;i<len;i++){var h=false;item=from[i];for(var j=0,jlen=target.length,jtem;j<jlen;j++){jtem=target[j];if(item.id===jtem.id&&item.level===jtem.level){h=true}}if(!h)res.push(item)}return res.concat(target)},getKeywrods:function(){return $(_instance.selector).find(".search-text").val()},widthImg:function(src,width){src=src||"";if(src.indexOf("googleapis")!=-1)return src;if(src.indexOf("x-oss-process")!=-1){return[src,"/resize,w_",width].join("")}else{return[src,"?w=",width].join("")}},winOpen:function(url){window.open(url+"?ref=NZH_search")},calcInputWidth:function(){var input=$(_instance.selector).find(".search-text");var copyText=$(_instance.selector).find(".text-copy");var val=input.val();copyText.text(val);if(_cacheSuburbsSelected.length===0){input.css("width","")}else{input.css("width",copyText.outerWidth()+5)}this.setPlaceholder()},getSlug:function(parts){var raw=parts.join(" ");return raw.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},slugToId:function(slug){return slug?(slug+"").split("-").pop():slug}}}var _proto=oneroof.prototype;_proto.destroy=function(){$(this.selector).empty()};var send=function(params){var dfd=$.Deferred();var _pms=[];for(var key in params){if(params.hasOwnProperty(key)){_pms.push(key+"="+params[key])}}var url=[_baseUrl,"?",_pms.join("&")].join("");$.ajax({url:url,type:"GET",headers:_baseHeader,beforeSend:function(xhr){var timestamp=(new Date).getTime();xhr.setRequestHeader("Timestamp",timestamp);xhr.setRequestHeader("Sign",signUrl(url,timestamp))},success:function(data){dfd.resolve(data)}});return dfd.promise()};var signUrl=function(url,timestamp){url=url.split("");var reg=/[a-z0-9]/i;var urlMap={};var urlList=[];for(var i=0,len=url.length,item;i<len;i++){item=url[i];if(reg.test(item)){if(urlMap[item]){urlMap[item]++}else{urlMap[item]=1;urlList.push(item)}}}var str="";for(var i=0,len=urlList.length,item;i<len;i++){item=urlList[i];str+=[item,urlMap[item]].join("")}if(timestamp){str+=timestamp}else{str+=(new Date).getTime()}return md5(str)};if(!$){console.log("jQuery not found.")}window.Oneroof=new oneroof})(window.document,window.jQuery||window.$);